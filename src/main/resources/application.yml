spring:
  application:
    name: content-moderation-perf

  datasource:
    url: jdbc:sqlite:./data/moderation_results.db
    driver-class-name: org.sqlite.JDBC

  jpa:
    database-platform: org.hibernate.community.dialect.SQLiteDialect
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        format_sql: true

  # Thread pool configuration
  task:
    execution:
      pool:
        core-size: 20
        max-size: 200
        queue-capacity: 500

server:
  port: 8080
  tomcat:
    threads:
      max: 200
      min-spare: 20

# Content Moderation Provider Strategy Configuration
content-moderation:
  # Active provider: deepcleer, alibaba, mock
  active-provider: ${MODERATION_PROVIDER:deepcleer}

  # Fallback configuration
  fallback:
    enabled: ${FALLBACK_ENABLED:true}
    secondary-provider: mock

# DeepCleer Content Moderation Configuration
deepcleer:
  api:
    # Set these via environment variables for security
    access-key: ${DEEPCLEER_ACCESS_KEY:3G1pY1HgAfJiNxp54wjd}
    app-id: ${DEEPCLEER_APP_ID:zim_1165137824}
    event-id: ${DEEPCLEER_EVENT_ID:article}

    # API endpoints - FIXED: Use correct Deepcleer API endpoint from documentation
    # Available clusters: Beijing (bj), Shanghai (sh), USA (fjny), Singapore (xjp)
    base-url: ${DEEPCLEER_BASE_URL:http://api-text-fjny.fengkongcloud.com}
    text-moderation-endpoint: /text/v4

    # Timeout configuration (milliseconds) - Deepcleer recommends 1s timeout
    connect-timeout-ms: 3000
    read-timeout-ms: 6000

    # Enable/disable provider
    enabled: ${DEEPCLEER_ENABLED:true}

    # Retry configuration
    retry:
      max-attempts: 3
      backoff-delay-ms: 1000
      backoff-multiplier: 2.0

    # Circuit breaker configuration
    circuit-breaker:
      enabled: true
      failure-rate-threshold: 50
      wait-duration-ms: 60000
      sliding-window-size: 10

# Alibaba Cloud Content Moderation Configuration
alibaba:
  cloud:
    # Set these via environment variables for security
    access-key-id: ${ALIBABA_ACCESS_KEY_ID:your-access-key-id}
    access-key-secret: ${ALIBABA_ACCESS_KEY_SECRET:your-access-key-secret}

    # Region configuration
    region-id: ap-southeast-1
    endpoint: green-cip.ap-southeast-1.aliyuncs.com

    # Service configuration
    service-name: comment_multilingual_pro_global

    # Timeout configuration (milliseconds)
    read-timeout: 6000
    connect-timeout: 3000

    # Mock mode for testing without real API calls (controls AlibabaProvider availability)
    mock-mode: ${MOCK_MODE:true}

# Performance Testing Configuration
performance:
  # Default concurrency settings
  default-concurrency: 10
  max-concurrency: 500

  # Rate limiting (requests per second, 0 = unlimited)
  rate-limit: 0

  # Retry configuration
  retry:
    max-attempts: 3
    backoff-delay-ms: 1000
    backoff-multiplier: 2.0

  # Circuit breaker
  circuit-breaker:
    enabled: true
    failure-threshold: 5
    timeout-duration-ms: 5000

# Actuator endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,metrics,prometheus,info
  metrics:
    export:
      prometheus:
        enabled: true

# Logging
logging:
  level:
    com.example.moderation: DEBUG
    org.springframework.web: INFO
    org.hibernate: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg - traceId=%X{traceId}%n"
